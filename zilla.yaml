---
name: example
vaults:
  external:
    type: filesystem
    options:
      keys:
        store: external/server/keys
        type: pkcs12
        password: generated
      trust:
        store: external/server/trust
        type: pkcs12
        password: generated
  internal:
    type: filesystem
    options:
      keys:
        store: internal/client/keys
        type: pkcs12
        password: generated
      trust:
        store: internal/client/trust
        type: pkcs12
        password: generated
      signers:
        store: internal/client/signers
        type: pkcs12
        password: generated
bindings:
  server9092:
    type: tcp
    kind: server
    options:
      host: 0.0.0.0
      port:
        - 9092
        - 10001-10003
    exit: proxy0
  proxy0:
    type: kafka-proxy
    kind: proxy
    options:
      external:
        host: kafka.external.net:10000+
        port: 9092
      internal:
        host: kafka-#.internal.net
        port: 9092
    exit: client9092
  client9092:
    type: tcp
    kind: client
    options:
      host: kafka-1.internal.net
      port: 9092
    routes:
      - when:
          - cidr: 0.0.0.0/0
  server9093:
    type: tcp
    kind: server
    options:
      host: 0.0.0.0
      port: 9093
    exit: secure-server9093
  secure-server9093:
    type: tls
    kind: server
    vault: external
    options:
      keys:
        - external.net
      trust:
        - clientca
      mutual: required
    exit: secure-proxy0
  secure-proxy0:
    type: kafka-proxy
    kind: proxy
    options:
      external:
        host: kafka-#.external.net
        port: 9093
      internal:
        host: kafka-#.internal.net
        port: 9094
    exit: secure-client0
  secure-client0:
    type: tls
    kind: client
    vault: internal
    options:
      trust:
        - serverca
      signers:
        - clientca
    exit: client0
  client0:
    type: tcp
    kind: client
    options:
      host: kafka.internal.net
      port: 9094
    routes:
      - when:
          - cidr: 0.0.0.0/0
  server9094:
    type: tcp
    kind: server
    options:
      host: 0.0.0.0
      port: 9094
    exit: secure-proxy9094
  secure-proxy9094:
    type: tls
    kind: proxy
    routes:
      - exit: client9094
        when:
          - authority: kafka*.internal.net
  client9094:
    type: tcp
    kind: client
    options:
      host: kafka.internal.net
      port: 9094
    routes:
      - when:
          - authority: kafka*.internal.net
